<script setup>
import { ref, onMounted, reactive } from 'vue'
import RightSide from "@/components/RightSide/right-side.vue";
import HomeArticle from "@/components/HomeArticle/index.vue"
import { useDetailStore } from "@/stores/detail-store.js"
import { getWebDetail } from "@/api/detail.js";
import { getHomeAticleList } from "@/api/article.js";
import { ElNotification } from "element-plus";

const detailStore = useDetailStore()
const articleList = ref([])
const articleTotal = ref()
/** 文章 */
const param = reactive({
  pageNum: 1, // 当前页
  size: 5, // 每页条目数
  loading: true, // 加载
})
/** 获取文章列表 */
const getArticleList = async (type) => {
  param.loading = true
  type === 'init' ? "" : (param.loading = true)
  let res = await getHomeAticleList({ pageNum: param.pageNum, pageSize: param.size })
  console.log("home",res)
  if (res && res.code == 0) {
    type === 'init' ? "" : (param.loading = false)
    const  { list, total } = res.result
    articleList.value = list
    articleTotal.value = total
    // console.log(list.length, total)
  }
  param.loading = false
}
/** 网站右侧 的个人信息 */
let configDetail = ref({})
/** 获取个人信息 */
const getConfigDetail = async () => {
  let res = await getWebDetail()
  if (res && res.code === 0) {
    // console.log(123)
    configDetail.value = res.result
    await detailStore.setWebDetail(configDetail.value)
    // console.log(detailStore.getWebDetail)
  } else {
    ElNotification({
      offset: 60,
      title: "温馨提示",
      message: "获取设置失败"
    })
  }
}
/** 数据初始化 */
const init = async () => {
  await getArticleList()
  await getConfigDetail()
}

onMounted(async () => {
  await init()
})

</script>

<template>
<div class="mi-home">
  <el-row>
    <el-col :sm="18" :xs="24">
      <HomeArticle :articleList="articleList" :articleTotal="articleTotal" :param="param" />
    </el-col>
    <el-col :sm="6" :xs="0">
      <!-- 我的博客信息 -->
      <RightSide :config-detail="configDetail" />
    </el-col>
  </el-row>
</div>
</template>

<style lang="scss" scoped>

</style>
